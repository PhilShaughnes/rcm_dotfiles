#!/usr/bin/env sh

# if [[ `xcode-select -p` != "/Applications/Xcode.app/Contents/Developer" && `xcode-select -p` != "/Applications/Xcode-beta.app/Contents/Developer" ]]; then
#   echo "Install XCode from the App Store"
#   exit 1
# else
#   echo "XCode is installed"
# fi



# assume we are in the dotfiles directory
echo "NOTE: we are assuming this is being run from the dotfiles directory.\n
if it is not, this will fail, since we have no way of knowing where it is yet."

source env


declare xcode_select_installed=`xcode-select --install 2>&1 | grep "command line tools are already installed"`
if [ -z "$xcode_select_installed" ]; then
  echo "Installing xcode-select"
  xcode-select --install
else
  echo "xcode-select installed"
fi

# if [ ! -x /usr/local/bin/docker ]; then
#   echo "Install Docker for Mac: https://www.docker.com/products/docker#/mac"
#   exit 1
# else
#     echo "Docker is installed"
# fi

if [ ! -x /usr/local/bin/brew ]; then
    echo "installing homebrew"
    /usr/bin/env ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
else
    echo "homebrew is installed"
fi

if [ ! -x /usr/local/bin/ansible ]; then
    echo "installing ansible via homebrew"
    brew install ansible
else
    echo "ansible is installed"
fi




# mac settings
echo "setting custom mac settings"
# assume we are in the correct directory...
# (cd $DOTFILES && . ./other/mac_settings.sh)
source ./other/mac_settings.sh

echo "brewing..."
# assume we are in the correct directory...
# (cd $DOTFILES && brew bundle)
brew bundle

# echo "fzf install..."
# $(brew --prefix)/opt/fzf/install

echo "linking dotfiles"
export RCRC='$DOTFILES/rcrc'
rcup -v

echo "Ready to go!"
# echo "You may want to to setup auto-install of asdf plugins"

